@using Com.HSJF.HEAS.Web.Helper
@model Com.HSJF.HEAS.Web.Models.Mortgage.PublicMortgageViewModel
@helper GetDictionary(string parentPath)
{
    foreach (var t in new Com.HSJF.HEAS.Web.Helper.DictionaryHelper().GetListByTypeAll("", parentPath))
    {
        <option value="@t.Value" data-show="@t.Disabled">@t.Text</option>
    }
}

<input id="PublicMortgage_ID" type="hidden" value="@ViewBag.ID" />
<div id="reject_block" class="hide" dialog-title="拒绝原因">
    <input type="hidden" data-field="RejectType" data-class="PublicMortgage" />
    <input type="hidden" data-field="Description" data-class="PublicMortgage" id="Mortgage_Description" />
</div>
<div class="page-content">
    <div class="page-header">
        <h1>
            <a class="label label-lg label-light arrowed" href="/Mortgage/MortgageIndex/">返回</a>
            &nbsp;
            签约
            <small>
                <i class="icon-double-angle-right"></i>
                详情
            </small>
        </h1>
    </div><!-- /.page-header -->
    <div class="hs-tool-bar">
    	<button class="btn btn-xs btn-success" id="submit" onclick="SubmitPublicMortgage();">
            <i class="icon-edit"></i>
            	提交
        </button>
    	<button class="btn btn-xs btn-primary" onclick="EditPublicMortgage();">
            <i class="icon-save"></i>
            	保存
        </button>
        <button class="btn btn-xs btn-danger" onclick="RejectPublicMortgage('@ViewBag.ID');">
            <i class="icon-remove"></i>
            	关闭
        </button>
        <span class="text-primary app_mright">
       		&nbsp;@CaseStatusHelper.GetStatsText(Model.CaseStatus)
       	</span>
       	<span class="app_mright">
       		&nbsp;案件状态:
       	</span>
        <span class="text-danger app_mright">
       		&nbsp;短借
       	</span>
       	<span class="app_mright">
       		&nbsp;案件类型:
       	</span>
       	<span class="text-success app_mright">
       		&nbsp;@Model.CaseNum
       	</span>&nbsp;
    	<span class="app_mright">
       		&nbsp;案件编号:
       	</span>
    </div>
    <div class="vspace-10"></div>

    <div class="row padt10">
        <div class="col-xs-12">
            <div class="tabbable">
                <ul class="nav nav-tabs" id="myTab">
                    <li class="active"><a data-toggle="tab" href="#publicMortgage">签约信息</a></li>
                    <li><a data-toggle="tab" href="#basic">进件信息</a></li>
                    <li><a data-toggle="tab" href="#researchInfo">调查信息</a></li>
                    <li><a data-toggle="tab" href="#AuditInfo">审核信息</a></li>
                    <li><a data-toggle="tab" href="#history">流程历史</a></li>
                </ul>

                <div class="tab-content">

                    <div id="publicMortgage" class="tab-pane active">

                        <h6 class="header smaller blue">签约信息</h6>
                        <div class="row padt10">
                        	<div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group hide">
                        		<input class="form-control" type="text" data-field="ID" data-class="PublicMortgage" id="PublicMortgageID"/>
                                <input class="form-control" type="hidden" data-field="CaseNum" data-class="PublicMortgage" disabled />
                        	</div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>合同号 <span class="red">*</span></label>
                                <input class="form-control" type="text"  data-field="ContractNo" data-class="PublicMortgage" maxlength="100" required/>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>出借人姓名 <span class="red">*</span></label>
                                <input class="form-control" type="text"  data-field="LenderName" data-class="PublicMortgage" maxlength="100" required/>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>签约金额 <span class="red">*</span></label>
                                <div class="input-group">
			                        <input class="form-control" type="text" data-field="ContractAmount" data-class="PublicMortgage" maxlength="15" onkeyup="formoney(event,this,2)" min="300000" required />
			                        <span class="input-group-addon">元</span>
			                    </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>签约日期 <span class="red">*</span></label>
                                <div class="input-group">
			                        <input class="form-control date-picker" type="text" data-field="ContractDate" data-class="PublicMortgage" valid-type="date" required/>
			                        <span class="input-group-addon">
			                            <i class="icon-calendar bigger-110"></i>
			                        </span>
			                    </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>签约人员 <span class="red">*</span></label>
                                <select class="form-control" type="text" data-field="ContractPerson" data-class="PublicMortgage" required>
                                    <option></option>
                                    @foreach (var item in (List<Com.HSJF.Infrastructure.Identity.Model.User>)ViewBag.PublicUsers)
                                    {
                                        <option value="@item.Id">@item.DisplayName</option>
                                    }
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>合同文件 <span class="red">*</span></label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);">点击上传附件 &nbsp;<span class="blue">(0)</span></label>
                    			<div class="hide" data-field="ContractFile" data-class="PublicMortgage" data-type="files" required><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>借款借据 <span class="red">*</span></label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);">点击上传附件 &nbsp;<span class="blue">(0)</span></label>
                				<div class="hide" data-field="FourFile" data-class="PublicMortgage" data-type="files" required><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>他证</label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);">点击上传附件 &nbsp;<span class="blue">(0)</span></label>
                    			<div class="hide" data-field="OtherFile" data-class="PublicMortgage" data-type="files"><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>收件收据</label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);">点击上传附件 &nbsp;<span class="blue">(0)</span></label>
                    			<div class="hide" data-field="CollectionFile" data-class="PublicMortgage" data-type="files"><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>还款委托书</label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);">点击上传附件 &nbsp;<span class="blue">(0)</span></label>
                    			<div class="hide" data-field="RepaymentAttorneyFile" data-class="PublicMortgage" data-type="files"><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>授权委托书</label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);">点击上传附件 &nbsp;<span class="blue">(0)</span></label>
                    			<div class="hide" data-field="PowerAttorneyFile" data-class="PublicMortgage" data-type="files"><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group shibai">
                                <label>签约失败理由 <span class="red">(签约"关闭"时必填)</span></label>
                                <textarea class="form-control" type="text"  data-field="RejectReason" data-class="PublicMortgage" rows="5"></textarea>
                            </div>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">打款账户</h6>
                        <div class="row padt10">
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>账户名称 <span class="red">*</span></label>
                                <input type="hidden" data-field="OpeningSite" data-class="PublicMortgage" required/>
                            	<select class="form-control" id="OpeningSite" onchange="changeAccount(this);" data-field="blank_blank_blank" data-class="PublicMortgage" required>
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>开户行 <span class="red">*</span></label>
                                <input class="form-control" type="text" data-field="OpeningBank" data-class="PublicMortgage" maxlength="100" required />
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>银行卡号 <span class="red">*</span></label>
                                <input class="form-control" type="text" data-field="BankCard" data-class="PublicMortgage" maxlength="100" required />
                            </div>
                        </div>

                    </div>

                    <div id="basic" class="tab-pane">

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">申请信息</h6>
                        <div class="row padt10">
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group hide">
                                <label>ID</label>
                                <input class="form-control" type="text" data-field="ID" data-class="BaseAudit" maxlength="100" />
                                <input class="form-control" type="hidden" data-field="CaseNum" data-class="BaseAudit" disabled />
                                <input class="form-control" type="hidden" data-field="BorrowerName" data-class="BaseAudit" />
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>地区</label>
                                <select class="form-control" data-field="DistrictID" data-class="BaseAudit" id="DistrictID" onchange="districtChange(true)" disabled>
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>分公司</label>
                                <select class="form-control" data-field="SalesGroupID" data-class="BaseAudit" id="SalesGroupID" onchange="salesGroupChange(true)" disabled>
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>销售人员</label>
                                <select class="form-control" data-field="SalesID" data-class="BaseAudit" id="SalesID" disabled>
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>申请额度</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="LoanAmount" data-class="BaseAudit" maxlength="15" onkeyup="formoney(event,this,2)" disabled />
                                    <span class="input-group-addon">元</span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>申请期限</label>
                                <select class="form-control" data-fill-code="Dict:-LoanTerm" data-field="Term" data-class="BaseAudit" disabled>
                                    <option></option>
                                    @GetDictionary("-LoanTerm")
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>申请利率（年）</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="AnnualRate" data-class="BaseAudit" valid-type="float" data-rate="rate" maxlength="8" disabled />
                                    <span class="input-group-addon">%</span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>服务费率</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="ServiceChargeRate" data-class="BaseAudit" valid-type="float" data-rate="rate" maxlength="8" disabled />
                                    <span class="input-group-addon">%</span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>客户保证金</label>
                                <div class="input-group">
                                    <input disabled class="form-control" type="text" data-field="CustEarnestMoney" data-class="BaseAudit" onkeyup="formoney(event,this,2)" maxlength="15" />
                                    <span class="input-group-addon">元</span>
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                                <label>还款来源</label>
                                <textarea class="form-control" rows="5" data-field="PaymentFactor" data-class="BaseAudit" maxlength="1000" disabled></textarea>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                                <label>借款用途</label>
                                <textarea class="form-control" rows="5" data-field="Purpose" data-class="BaseAudit" maxlength="1000" disabled></textarea>
                            </div>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">
                            关系人
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="basecase_person_list" class="table table-striped table-bordered table-hover" for="dialog_person" data-class="BaseAudit" data-field="RelationPersonAudits" data-child="RelationPersonAudits">
                                <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>关系人类型</th>
                                        <th>证件类型</th>
                                        <th>证件号码</th>
                                        <th>婚姻状况</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="vspace-10"></div>

                        <h6 class="header smaller blue">
                            房产信息
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="basecase_facility_list" class="table table-striped table-bordered table-hover" for="dialog_facility" data-class="BaseAudit" data-field="CollateralAudits" data-child="CollateralAudits">
                                <thead>
                                    <tr>
                                        <th>类型</th>
                                        <th>楼盘名称</th>
                                        <th>地址</th>
                                        <th>权利人</th>
                                        <th>面积<span>（单位：米<sup>2</sup>）</span></th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="researchInfo" class="tab-pane">
                        <h6 class="header smaller blue">
                            案件信息
                        </h6>
                        <div class="row padt10">
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>综合抵押率</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="ComprehensiveRate" data-class="BaseAudit" valid-type="float" data-rate="rate" maxlength="8" disabled />
                                    <span class="input-group-addon">%</span>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>抵押次数</label>
                                <select class="form-control" data-fill-code="Dict:-FSLoan" data-field="MortgageOrder" data-class="BaseAudit" disabled>
                                    <option></option>
                                    @GetDictionary("-FSLoan")
                                </select>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>外访费（下户费）</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="OutboundCost" data-class="BaseAudit" maxlength="15" onkeyup="formoney(event,this,2)" disabled />
                                    <span class="input-group-addon">元</span>
                                </div>
                            </div>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">
                            被执行人情况
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="audit_EnforcementPersons_list" class="table table-striped table-bordered table-hover" for="dialog_EnforcementPersons" data-class="BaseAudit" data-field="EnforcementPersons" data-child="EnforcementPersons">
                                <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>全国被执行网情况</th>
                                        <th>法院开庭记录</th>
                                        <th>Lawxin</th>
                                        <th>失信网失信记录</th>
                                        <th>社会负面新闻</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">
                            工商税务情况
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="audit_IndustryCommerceTaxs_list" class="table table-striped table-bordered table-hover" for="dialog_IndustryCommerceTaxs" data-class="BaseAudit" data-field="IndustryCommerceTaxs" data-child="IndustryCommerceTaxs">
                                <thead>
                                    <tr>
                                        <th>企业名称</th>
                                        <th>企业年检情况</th>
                                        <th>公司实际经营</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">
                            房屋明细
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="audit_HouseDetails_list" class="table table-striped table-bordered table-hover" for="dialog_HouseDetails" data-class="BaseAudit" data-field="HouseDetails" data-child="HouseDetails">
                                <thead>
                                    <tr>
                                        <th>房屋名称</th>
                                        <th>评估价<span>（单位：元）</span></th>
                                        <th>房屋类型</th>
                                        <th>抵押情况</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="AuditInfo" class="tab-pane">
                        <h6 class="header smaller blue">
                            个人资信情况
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="audit_IndividualCredits_list" class="table table-striped table-bordered table-hover" for="dialog_IndividualCredits" data-class="BaseAudit" data-field="IndividualCredits" data-child="IndividualCredits">
                                <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>信用卡</th>
                                        <th>房贷、车贷</th>
                                        <th>其他贷款</th>
                                        <th>逾期情况</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">
                            企业资信情况
                        </h6>
                        <div class="table-responsive">
                            <table disabled id="audit_EnterpriseCredits_list" class="table table-striped table-bordered table-hover" for="dialog_EnterpriseCredits" data-class="BaseAudit" data-field="EnterpriseCredits" data-child="EnterpriseCredits">
                                <thead>
                                    <tr>
                                        <th>企业名称</th>
                                        <th>企业贷款卡</th>
                                        <th>企业负债信息</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                        <div class="vspace-10"></div>
                        <h6 class="header smaller blue">产品信息</h6>
                        <div class="row padt10">
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>审批金额</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="AuditAmount" data-class="BaseAudit" maxlength="15" onkeyup="formoney(event,this,2)" disabled />
                                    <span class="input-group-addon">元</span>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>审批期限</label>
                                <select class="form-control" data-fill-code="Dict:-LoanTerm" data-field="AuditTerm" data-class="BaseAudit" disabled>
                                    <option></option>
                                    @GetDictionary("-LoanTerm")
                                </select>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>审批利率（年）</label>
                                <div class="input-group">
                                    <input class="form-control" type="text" data-field="AuditRate" data-class="BaseAudit" valid-type="float" data-rate="rate" maxlength="8" disabled />
                                    <span class="input-group-addon">%</span>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>放款日期</label>
                                <div class="input-group">
                                    <input class="form-control date-picker" type="text" data-field="LendingDate" data-class="BaseAudit" valid-type="date" disabled />
                                    <span class="input-group-addon">
                                        <i class="icon-calendar bigger-110"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>借款申请书</label>
                                <label class="form-control control-label hs-clickable text-center" onclick="fileUploadFunction(this);" disabled>查看附件 &nbsp;<span class="blue">(0)</span></label>
                                <div class="hide" data-field="LoanProposedFile" data-class="BaseAudit" data-type="files"><ul class="fileupload_list"></ul></div>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12 form-group">
                                <label>放款条件</label>
                                <select class="form-control" data-fill-code="Dict:-LoanTerm" data-field="LendingTerm" data-class="BaseAudit" disabled>
                                    <option></option>
                                    @GetDictionary("-LendingTerm")
                                </select>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                                <label>批注意见</label>
                                <textarea class="form-control" rows="5" data-field="AuditComment" data-class="BaseAudit" maxlength="1000" disabled></textarea>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 form-group">
                                <label>签约要件</label>
                                <textarea class="form-control" rows="5" data-field="ContractFileInfo" data-class="BaseAudit" maxlength="1000" disabled></textarea>
                            </div>

                            <div class="vspace-10"></div>
                            <h6 class="header smaller blue">第三方信息</h6>
                            <div class="row padt10">
                                <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                    <label>案件模式</label>
                                    <select disabled class="form-control" data-fill-code="Dict:-CaseMode" data-field="CaseMode" data-class="BaseAudit" onchange="caseModel(this);">
                                        <option></option>
                                        @GetDictionary("-CaseMode")
                                    </select>
                                </div>
                                <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                    <label>第三方平台</label>
                                    <select disabled class="form-control" data-fill-code="Dict:-ThirdPlatform" data-field="ThirdParty" data-class="BaseAudit">
                                        <option></option>
                                        @GetDictionary("-ThirdPlatform")
                                    </select>
                                </div>
                                <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                    <label>第三方审批金额</label>
                                    <div class="input-group">
                                        <input disabled class="form-control" type="text" data-field="ThirdPartyAuditAmount" data-class="BaseAudit" maxlength="15" onkeyup="formoney(event,this,2)" />
                                        <span class="input-group-addon">元</span>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                    <label>第三方审批期限</label>
                                    <select disabled class="form-control" data-fill-code="Dict:-LoanTerm" data-field="ThirdPartyAuditTerm" data-class="BaseAudit">
                                        <option></option>
                                        @GetDictionary("-LoanTerm")
                                    </select>
                                </div>
                                <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                    <label>第三方审批利率（年）</label>
                                    <div class="input-group">
                                        <input disabled class="form-control" type="text" data-field="ThirdPartyAuditRate" data-class="BaseAudit" data-rate="rate" maxlength="8" />
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 col-sm-12 col-xs-12 form-group">
                                    <label>平台保证金</label>
                                    <div class="input-group">
                                        <input disabled class="form-control" type="text" data-field="EarnestMoney" data-class="BaseAudit" onkeyup="formoney(event,this,2)" maxlength="15" />
                                        <span class="input-group-addon">元</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                	<div id="history" class="tab-pane">
                        <div class="row padt10">
                            <div id="timeline-1">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-10 col-sm-offset-1">
                                        <div class="timeline-container">
                                            <div class="timeline-items" id="historyContent">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- /.page-content -->
@Html.Partial("dialog")
<script type="text/javascript" src="../../js/init.js"></script>
<script type="text/javascript">

    //提交
    function SubmitPublicMortgage() {
        $('[data-field="ContractAmount"]').removeClass("border-red");
        $('[data-class="PublicMortgage"][data-field="RejectReason"]').removeAttr("required");        
        if (ValidateCheck(".page-content")) {
			if($('[data-field="CaseMode"]').val()=="-CaseMode-JuJian"){//居间模式
				if (Number(rmoney($('[data-field="ContractAmount"]').val())) <= Number(rmoney($('[data-field="ThirdPartyAuditAmount"]').val()))) {
				    ConfirmBox("<div>是否确定通过?</div><br><textarea rows='5' cols='38' width='100%' placeholder='备注' id='des'></textarea>", function () {
	                    $('[data-field="Description"]').val($("#des").val());
	                    var data_case = GetJsonData("PublicMortgage", $(window.document));
	                    data_case.ID = $("#PublicMortgageID").val();
	                    selAccount();
	                    AjaxMethod("post", "/Mortgage/SubmitMortgage", data_case, function (r) {
	                        MessageBox("提交成功", function () {
	                            window.close();
	                        });
	                        hideLoading();
	                        //					    showAlert("提交成功，3秒后自动关闭页面");
	                        //						closeAll();
	                    }, true);
	                });
	            } else {
	                showAlert("签约金额不能大于第三方审批金额", "error");
	                $("[href='#publicMortgage']").click();
	                $('[data-field="ContractAmount"]').addClass("border-red");
	            }
			}else{//自由资金
				if (Number(rmoney($('[data-field="ContractAmount"]').val())) <= Number(rmoney($('[data-field="AuditAmount"]').val()))) {
				    ConfirmBox("<div>是否确定通过?</div><br><textarea rows='5' cols='38' width='100%' placeholder='备注' id='des'></textarea>", function () {
	                    $('[data-field="Description"]').val($("#des").val());
	                    var data_case = GetJsonData("PublicMortgage", $(window.document));
	                    data_case.ID = $("#PublicMortgageID").val();
	                    selAccount();
	                    AjaxMethod("post", "/Mortgage/SubmitMortgage", data_case, function (r) {
	                        MessageBox("提交成功", function () {
	                            window.close();
	                        });
	                        hideLoading();
	                        //					    showAlert("提交成功，3秒后自动关闭页面");
	                        //						closeAll();
	                    }, true);
	                });
	            } else {
	                showAlert("签约金额不能大于审批金额", "error");
	                $("[href='#publicMortgage']").click();
	                $('[data-field="ContractAmount"]').addClass("border-red");
	            }
			}
           
        }
    }

    //保存
    function EditPublicMortgage() {
        $('[data-class="PublicMortgage"][data-field="RejectReason"]').removeAttr("required");    	
        if (ValidateCheckSave(".page-content")) {
            var data_case = GetJsonData("PublicMortgage");
            data_case.ID = $("#PublicMortgageID").val();
            selAccount();
            AjaxMethod("post", "/Mortgage/EditMortgage", data_case, function (r) {
                showAlert("保存成功");
                hideLoading();
                //          window.location = "/Mortgage/MortgageIndex?status=ss";
            }, true);
        }
    }

    //自动保存
    function AutoSave() {
        var data_case = GetJsonData("PublicMortgage");
		data_case.ID = $("#PublicMortgageID").val();
		selAccount();
        AjaxMethod("post", "/Mortgage/EditMortgage", data_case, function (r) {
            showAlert("保存成功");
            hideLoading();
        }, true);
    }
    //拒绝
    function RejectPublicMortgage(id) {
        $('[data-class="PublicMortgage"][data-field="RejectReason"]').attr("required","required");
        if (ValidateCheck(".shibai")) {
            ConfirmBox("<div>是否确定关闭?</div><br><textarea rows='5' cols='38' width='100%' placeholder='备注' id='des'></textarea>", function () {
	            $('#Mortgage_Description').val($("#des").val());
	            AjaxMethod("post", "/Mortgage/RejectMortgage", { id: id, RejectReason: $('[data-field="RejectReason"]').val(), Description: $('#Mortgage_Description').val() }, function (r) {
	                MessageBox("拒绝成功", function () {
	                    window.close();
	                });
	                hideLoading();
	                //	            showAlert("拒绝成功，3秒后自动关闭页面", "error");
	                //				closeAll();
	            }, true);
	        });
        }
    }

    //页面初始化
    jQuery(function ($) {
        //加载页面数据
     	var date = new Date();
        var htm = "";
        for (var i = date.getFullYear() - 70; i < date.getFullYear() + 70; i++) {
            htm = htm + "<option ='" + i + "'>" + i + "</option>";
        }
        $('[data-field="CompletionDate"]').append(htm);
        LoadPageData();
        rate();
        dictionaryHide();
    });

    //加载页面数据
    var LoadPageData = function () {
        var bc_id = $("#PublicMortgage_ID").val();
        showLoading();
        AjaxMethod("get", "/Mortgage/GetPublicMortgage", { id: bc_id }, function (r) {
            SetJsonData(r["Data"], "PublicMortgage");
            $("#PublicMortgageID").val(r["Data"].ID);
            AjaxMethod("get", "/Audit/GetBaseAudit", { id: bc_id }, function (r) {
            	if (r.Data.AuditHistory) {
	                var str = '<div class="timeline-label">' +
	                    '<span class="label label-primary arrowed-in-right label-lg">' +
	                    '<b>当前节点</b>' +
	                    '</span>' +
	                    '</div>';
	                var hisArr = r.Data.AuditHistory;
	                for (var i = 0; i < hisArr.length; i++) {
	                    var color = "red";
	                    if (hisArr[i].Action == "提交" || hisArr[i].Action == "通过") {
	                        color = "green";
	                    }
	                    var Description = "";
	                    var flag = "";
	                    if (hisArr[i].Description != null && hisArr[i].Description != "") {
	                        Description = '<div class="widget-body">' +
	                            '<div class="widget-main ' + color + '">' +
	                            '备注：<br>' +
	                            '<span class="' + color + '">' + hisArr[i].Description + '</span>' +
	                            '<div class="space-6"></div>' +
	                            '</div>' +
	                            '</div>';
	                        flag = '<span class="widget-toolbar">' +
	                            '<a href="#" data-action="collapse">' +
	                            '<i class="icon-chevron-up"></i>' +
	                            '</a>' +
	                            '</span>';
	                    }
	                    var user = "";
	                    if (i != 0) {
	                        user = hisArr[i].CreatUser;
	                    }
	                    var date_time = "";
	                    if (dateFormat(hisArr[i].CreateTime) != "") {
	                        date_time = '<i class="icon-time bigger-110"></i>' + dateFormat(hisArr[i].CreateTime);
	                    }
	                    str = str + '<div class="timeline-item clearfix">' +
	                        '<div class="timeline-info">' +
	                        '<i class="timeline-indicator icon-star btn btn-warning no-hover green"></i>' +
	                        '</div>' +
	                        '<div class="widget-box transparent">' +
	                        '<div class="widget-header widget-header-small">' +
	                        '<h5 class="smaller">' +
	                        '<a class="blue">' + hisArr[i].CaseStatusTest + '</a>&nbsp;&nbsp;' +
	                        '<span class="grey">' + user + '</span>&nbsp;&nbsp;' +
	                        '<span class="' + color + '">' + hisArr[i].Action + '</span>' +
	                        '</h5>' +
	                        '<span class="widget-toolbar no-border">' +
	                        date_time +
	                        '</span>' +
	                        flag +
	                        '</div>' +
	                        Description +
	                        '</div>' +
	                        '</div>';
	                }
	                $("#historyContent").html(str);
	            }
                GetDistrict(false, function () {
                    $("#basic [data-class='BaseAudit'][data-field='DistrictID']").val(r["Data"]["DistrictID"]);
                    districtChange(false, function () {
                        $("#basic [data-class='BaseAudit'][data-field='SalesGroupID']").val(r["Data"]["SalesGroupID"]);
                        salesGroupChange(false, function () {
                            GetDictionary($("#borrower_idtype"), "-DocType", function () {
                            	r["Data"].RejectReasonText = r["Data"].RejectReason;
                                SetJsonData(r["Data"], "BaseAudit");
                                if($('[data-field="LendingTerm"]').val()=="-LendingTerm-CollectionFile"){
                                	$('[data-field="CollectionFile"]').attr("required",true);
                                	$('[data-field="CollectionFile"]').siblings().eq(0).html('收件收据 <span class="red">*</span>');
                                }
                                if($('[data-field="LendingTerm"]').val()=="-LendingTerm-OtherFile"){
                                	$("#publicMortgage").find('[data-field="OtherFile"]').attr("required",true);
                                	$("#publicMortgage").find('[data-field="OtherFile"]').siblings().eq(0).html('他证 <span class="red">*</span>');
                                }
                                $("tbody").children("tr").each(function (index) {
                                    if (index != 0) {
                                        $(this).prepend($(this).children('[data-field="ID"]').clone());
                                        $(this).children('[data-field="ID"]').eq(1).remove();
                                    }
                                });
                                $('.PublicMortgage').attr("data-class","PublicMortgage");
                                selAccount();
                                hideLoading();
                            });
                        });
                    });
                });
            }, false);
        }, false);

    };
</script>
<style>
    .dis {
        cursor: no-drop !important;
        background: rgba(0,0,0,0.06) !important;
    }

    .timeline-container:not(.timeline-style2) .timeline-indicator {
        opacity: 1;
        border-radius: 100%;
        display: inline-block;
        font-size: 16px;
        height: 36px;
        line-height: 30px;
        width: 36px;
        text-align: center;
        text-shadow: none !important;
        padding: 0;
        cursor: default;
        border: 3px solid #FFF !important;
    }

    #reject_block {
        overflow: hidden;
        display: block;
        margin: 0 auto;
    }

</style>
